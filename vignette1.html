<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<title>place a bet</title>

<script src="libs/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.1/css/united.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.1/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/respond.min.js"></script>
<style type="text/css">

	/* padding for bootstrap navbar */
	body {
		padding-top: 20px;
		padding-bottom: 20px;
	}
	@media (max-width: 979px) {
		body {
			padding-top: 0;
		}
	}

	/* offset scroll position for anchor links (for fixed navbar) */
	@media (min-width: 980px) {
		.section h2 {
			padding-top: 52px;
			margin-top: -52px;
		}
		.section h3 {
			padding-top: 52px;
			margin-top: -52px;
		}
	}

	p {
		font-size: 13px;
	}

	/* don't use link color in navbar */
	.dropdown-menu>li>a {
		color: black;
	}

	/* some padding for disqus */
	#disqus_thread {
		margin-top: 45px;
	}

</style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">

<h1>betfaiR</h1>
<nav class="navbar navbar-inverse">
    <div class="container-fluid">
        <div class="navbar-header">
            <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#betfaiR-nav">
                <span class="sr-only">Toggle Navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://github.com/durtal" class="navbar-brand">durtal@github</a>
        </div>
        <div class="collapse navbar-collapse" id="betfaiR-nav">
            <ul class="nav navbar-nav">
                <li>
                    <a href="index.html">home</a>
                </li>
                <li class="dropdown">
                    <a href="Primary" class="dropdown-toggle" data-toggle="dropdown">
                        Functions <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li class="dropdown-header">Environment</li>
                        <li>
                            <a href="betfair.html">betfair</a>
                        </li>
                        <li class="dropdown-header">Helpers</li>
                        <li>
                            <a href="marketFilter.html">marketFilter</a>
                        </li>
                        <li>
                            <a href="bf_helpers.html">bf_helpers</a>
                        </li>
                        <li>
                            <a href="betfair_login.html">bf_login</a>
                        </li>
                        <li>
                            <a href="request_functions.html">requests</a>
                        </li>
                        <li>
                            <a href="betfair_POST.html">bf_post</a>
                        </li>
                        <li>
                            <a href="betfair_check.html">bf_check</a>
                        </li>
                        <li>
                            <a href="betfair_parse.html">bf_parse</a>
                        </li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="Methods" class="dropdown-toggle" data-toggle="dropdown">
                        Methods <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li class="dropdown-header">summary data</li>
                        <li>
                            <a href="methods_competitions.html">competitions</a>
                        </li>
                        <li>
                            <a href="methods_countries.html">countries</a>
                        </li>
                        <li>
                            <a href="methods_events.html">events</a>
                        </li>
                        <li>
                            <a href="methods_eventTypes.html">eventTypes</a>
                        </li>
                        <li>
                            <a href="methods_venues.html">venues</a>
                        </li>
                        <li class="dropdown-header">login</li>
                        <li>
                            <a href="login_session.html">login + session</a>
                        </li>
                        <li class="dropdown-header">market data</li>
                        <li>
                            <a href="methods_marketTypes.html">marketTypes</a>
                        </li>
                        <li>
                            <a href="methods_marketCatalogue.html">marketCatalogue</a>
                        </li>
                        <li>
                            <a href="methods_marketBook.html">marketBook</a>
                        </li>
                        <li>
                            <a href="methods_marketPnL.html">marketPnL</a>
                        </li>
                        <li class="dropdown-header">orders</li>
                        <li>
                            <a href="placeOrders.html">placeOrders</a>
                        </li>
                        <li>
                            <a href="cancelOrders.html">cancelOrders</a>
                        </li>
                        <li>
                            <a href="replaceOrders.html">replaceOrders</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="Misc" class="dropdown-toggle" data-toggle="dropdown">
                        Misc <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="betting_enums.html">Betting Enums</a>
                        </li>
                    </ul>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="http://www.github.com/durtal/betfaiR"> <i class="fa fa-github-square fa-lg"></i></a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div id="header">
<h1 class="title">place a bet</h1>
</div>


<p>This vignette will walk through the methods used to place a bet using the <code>betfaiR</code> package. It will exhibit a number of different options, returning different data, before finally placing a bet, then replacing the bet, and ultimately cancelling the bet - it might become expensive if I let the bets ride.</p>
<p>The primary function in the <code>betfaiR</code> package is the <code>betfair</code> function, which returns an environment with the various methods to query the Betfair API.</p>
<div id="login" class="section level3">
<h3>login</h3>
<p>First we need to login in, this requires a valid username, valid password, and valid API key. The <a href="betfair.html#appendix">appendix</a> on the <code>betfair</code> page talks about how to best store these details in a safe manner. The suggestions come from <a href="https://twitter.com/JennyBryan">Jenny Bryan</a> via <a href="https://twitter.com/hadleywickham">Hadley Wickham’s</a> <a href="https://github.com/hadley/httr"><code>httr</code></a> package (which is used by <code>betfaiR</code> )</p>
<p>So to login, first load the library, then login, saving the returned environment to a variable, here I named it <code>bf</code>. This can then be printed to see the available methods:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(betfaiR)
bf &lt;-<span class="st"> </span><span class="kw">betfair</span>(<span class="dt">usr =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;BETFAIR_USR&quot;</span>),
              <span class="dt">pwd =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;BETFAIR_PWD&quot;</span>),
              <span class="dt">key =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;BETFAIR_KEY&quot;</span>))
bf</code></pre>
<pre><code>&lt;betfaiR API&gt;
Methods available: 
    $cancelOrders(..., marketId = NA) 
    $competitions(filter = marketFilter()) 
    $countries(filter = marketFilter()) 
    $events(filter = marketFilter()) 
    $eventTypes(filter = marketFilter()) 
    $login(usr, pwd, key) 
    $marketBook(marketIds = list(), priceProjection = &quot;EX_BEST_OFFERS&quot;, orderProjection = &quot;EXECUTABLE&quot;, matchProjection = &quot;NO_ROLLUP&quot;) 
    $marketCatalogue(filter = marketFilter(), marketProjection = &quot;EVENT&quot;, sort = NULL, maxResults = 1, keepRules = FALSE) 
    $marketPnL(marketIds, settled = NULL, bsp = NULL, NET = NULL) 
    $marketTypes(filter = marketFilter()) 
    $placeOrders(marketId, selectionId, orderType = &quot;LIMIT&quot;, handicap = NULL, side = &quot;BACK&quot;, limitOrder = limitOrder(), 
   limitOnCloseOrder = limitOnCloseOrder(), marketOnCloseOrder = NULL) 
    $replaceOrders(..., marketId) 
    $session() 
    $venues(filter = marketFilter()) </code></pre>
</div>
<div id="searching-for-markets" class="section level3">
<h3>searching for markets</h3>
<p>It’s unlikely to be the case that you know the marketId or selectionId to go straight to placing a bet, so searching for the markets is usually required. This can be done via a number of different methods, which include, <a href="methods_competitions.html"><code>competitions</code></a>, <a href="methods_countries.html"><code>countries</code></a>, <a href="methods_events.html"><code>events</code></a>, <a href="methods_eventTypes.html"><code>eventTypes</code></a>, <a href="methods_venues.html"><code>venues</code></a> and perhaps most useful <a href="methods_marketCatalogue.html"><code>marketCatalogue</code></a> and the helper function <a href="marketFilter.html"><code>marketFilter</code></a> function.</p>
<p>You can filter on a wide variety of parameters, but some familiarity with these parameters is useful, for example, knowing that an <strong>eventTypeId</strong> of 1 will return football markets, while <strong>eventTypeId</strong> of 7 will return horse racing markets. We will look for 5 horse racing markets, in the UK, and we will sort by the amount traded. The response (stored as <code>markets</code> below) can be passed to <code>summary</code> for details about the 5 markets, in an easy to read format which allows users to quickly identify the market they’re interested in:</p>
<pre class="sourceCode r"><code class="sourceCode r">markets &lt;-<span class="st"> </span>bf$<span class="kw">marketCatalogue</span>(<span class="dt">filter =</span> <span class="kw">marketFilter</span>(<span class="dt">eventTypeIds =</span> <span class="dv">7</span>,
                                                    <span class="dt">marketCountries =</span> <span class="st">&quot;GB&quot;</span>),
                              <span class="dt">maxResults =</span> <span class="dv">5</span>,
                              <span class="dt">sort =</span> <span class="st">&quot;MAXIMUM_TRADED&quot;</span>)
<span class="kw">summary</span>(markets)</code></pre>
<pre><code>
Market ID:      1.117674262
Event ID:       27390233 
Market Name:    Gold Cup
Event Name:     Cheltenham 2016 
Matched:        142804.5
 ---------------------------------------------------------------------------
Market ID:      1.117674259
Event ID:       27390233 
Market Name:    Champion Hrd
Event Name:     Cheltenham 2016 
Matched:        130170.16
 ---------------------------------------------------------------------------
Market ID:      1.118987605
Event ID:       27453850 
Market Name:    2000 Guineas
Event Name:     Newmarket 2016 
Matched:        79939.48
 ---------------------------------------------------------------------------
Market ID:      1.116824143
Event ID:       27334314 
Market Name:    King George VI Chs
Event Name:     Kemp 26th Dec 
Matched:        76843.66
 ---------------------------------------------------------------------------
Market ID:      1.118224623
Event ID:       27419382 
Market Name:    Grand National
Event Name:     Aintree 2016 
Matched:        67384.06
 ---------------------------------------------------------------------------</code></pre>
<p>Let’s look at the first market, the market name is <strong>Gold Cup</strong> while the event name is <strong>Cheltenham 2016</strong>. Below we query this market, and retrieve additional data about the runners, via the <code>marketProjection</code> parameter:</p>
<pre class="sourceCode r"><code class="sourceCode r">marketId &lt;-<span class="st"> </span>markets[[<span class="dv">1</span>]]$market$marketId
market &lt;-<span class="st"> </span>bf$<span class="kw">marketCatalogue</span>(<span class="dt">filter =</span> <span class="kw">marketFilter</span>(<span class="dt">marketIds =</span> marketId),
                             <span class="dt">marketProjection =</span> <span class="st">&quot;RUNNER_DESCRIPTION&quot;</span>)
<span class="kw">summary</span>(market)</code></pre>
<pre><code>
Market ID:      1.117674262 
Market Name:    Gold Cup 
Matched:        142814.5

Runners:     59 
 selectionId  runnerName handicap sortPriority
     5978449   Coneygree        0            1
     6896665     Vautour        0            2
     5517026 Don Cossack        0            3
     7122507    Don Poli        0            4
     6987962    Djakadam        0            5
     4360454    Cue Card        0            6

 ---------------------------------------------------------------------------</code></pre>
<p>Now we know the <code>marketId</code> we can use the <a href="methods_marketBook.html"><code>marketBook</code></a> method to get up to date (well, with a second or so delays) market data. The response of this method can also be passed to <code>summary</code> for pretty printing, before being mined further. One unfortunate thing about the <code>marketBook</code> method is that it only returns selectionIds, rather than runner names, so the likes of <strong>Coneygree</strong> or <strong>Vautour</strong> are not included.</p>
<pre class="sourceCode r"><code class="sourceCode r">market_data &lt;-<span class="st"> </span>bf$<span class="kw">marketBook</span>(<span class="dt">marketIds =</span> marketId,
                             <span class="dt">priceProjection =</span> <span class="st">&quot;EX_BEST_OFFERS&quot;</span>)
<span class="kw">summary</span>(market_data)</code></pre>
<pre><code>
Market ID:      1.117674262 
Matched:        142888.1 
Available:      16078.92

Runners:     59 
     .id selectionId handicap status lastPriceTraded totalMatched
 5978449     5978449        0 ACTIVE             6.6     21772.23
 6896665     6896665        0 ACTIVE             6.8     33703.85
 5517026     5517026        0 ACTIVE             8.4     16789.26
 7122507     7122507        0 ACTIVE             8.4     16910.53
 6987962     6987962        0 ACTIVE             9.2      9687.06
 4360454     4360454        0 ACTIVE            13.5      6225.25

 ---------------------------------------------------------------------------</code></pre>
</div>
<div id="placing-a-bet" class="section level3">
<h3>placing a bet</h3>
<p>Let’s place a lay bet on the current favourite using the <a href="placeOrders.html"><code>placeOrders</code></a> method, Coneygree, we don’t want this to be matched, so the lay will be at the 1.01 price, and for just £2. To place a bet, we need the <code>marketId</code> and <code>selectionId</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r">marketId &lt;-<span class="st"> </span>market_data[[<span class="dv">1</span>]]$market$marketId
selectionId &lt;-<span class="st"> </span>market_data[[<span class="dv">1</span>]]$runners[[<span class="dv">1</span>]]$basic$selectionId

bet &lt;-<span class="st"> </span>bf$<span class="kw">placeOrders</span>(<span class="dt">marketId =</span> marketId,
                      <span class="dt">selectionId =</span> selectionId, 
                      <span class="dt">side =</span> <span class="st">&quot;LAY&quot;</span>,
                      <span class="dt">limitOrder =</span> bf_helpers$<span class="kw">limitOrder</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">price =</span> <span class="fl">1.01</span>))</code></pre>
<p>With any luck we will get a successful response:</p>
<pre class="sourceCode r"><code class="sourceCode r">bet</code></pre>
<pre><code>
Status:         SUCCESS
MarketId:       1.117674262</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(bet)</code></pre>
<pre><code>
Status:         SUCCESS
MarketId:       1.117674262

Order:
  status       betId               placedDate averagePriceMatched
 SUCCESS 59148940185 2015-12-06T22:35:40.000Z                   0
 sizeMatched
           0

Instructions:
 selectionId handicap size price persistenceType orderType side
     5978449        0    2  1.01           LAPSE     LIMIT  LAY</code></pre>
<p>We’ll now change that order using the <a href="replaceOrders.html"><code>replaceOrders</code></a> function, for this we need the betId (which was returned above), and we’ll change the price we wish to be matched at to 1.10.</p>
<pre class="sourceCode r"><code class="sourceCode r">betId &lt;-<span class="st"> </span>bet$order$betId
bet1 &lt;-<span class="st"> </span>bf$<span class="kw">replaceOrders</span>(bf_helpers$<span class="kw">replace_inst</span>(<span class="dt">betId =</span> betId,
                                                 <span class="dt">newPrice =</span> <span class="fl">1.10</span>),
                         <span class="dt">marketId =</span> marketId)</code></pre>
<p>This update was a <strong>SUCCESS</strong>, but we don’t want to leave the bet there, so lets cancel it. We can either target this specific bet using it’s ID, returned above, or we can cancel all bets as below:</p>
<pre class="sourceCode r"><code class="sourceCode r">(cancel &lt;-<span class="st"> </span>bf$<span class="kw">cancelOrders</span>())</code></pre>
<pre><code>
Status:  SUCCESS</code></pre>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>


</body>
</html>
